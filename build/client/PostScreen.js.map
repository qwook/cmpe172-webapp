{"version":3,"sources":["../../client/PostScreen.js"],"names":["PostScreen","state","image","posting","price","file","refs","fileUpload","files","fr","FileReader","onload","onFileLoaded","bind","readAsDataURL","data","setState","target","result","e","value","match","priceMatch","stripped","replace","zeroStrip","preventDefault","ajax","url","method","contentType","JSON","stringify","title","form","inputTitle","description","inputDescription","inputPrice","on","res","parse","response","success","context","router","push","id","send","submitForm","checkPrice","onFileUpload","Component","contextTypes","PropTypes","object"],"mappings":"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","file":"PostScreen.js","sourcesContent":["\nimport React from 'react';\nimport Ajax from 'simple-ajax';\n\nimport SmartImage from './SmartImage';\n\nexport default class PostScreen extends React.Component {\n  \n  static contextTypes = {\n      router: React.PropTypes.object\n  };\n\n  static priceMatch = /^[0-9]+(\\.[0-9]?[0-9]?)?$/;\n  static zeroStrip = /^(0+)/;\n\n  state = {\n    image: null,\n    posting: false,\n  };\n\n  price = 0;\n\n  onFileUpload() {\n    var file = this.refs.fileUpload.files[0];\n\n    var fr = new FileReader();\n    fr.onload = this.onFileLoaded.bind(this);   // onload fires after reading is complete\n    fr.readAsDataURL(file);    // begin reading\n  }\n\n  onFileLoaded(data) {\n    this.setState({\n      image: data.target.result\n    })\n  }\n\n  checkPrice(e) {\n\n    if (e.target.value.match(PostScreen.priceMatch)) {\n      var stripped = e.target.value.replace(PostScreen.zeroStrip, \"\");\n      if (e.target.value != stripped) {\n        e.target.value = stripped;\n      }\n      this.price = e.target.value;\n    } else {\n      if (e.target.value != \"\") {\n        e.target.value = this.price;\n      }\n    }\n\n    if (e.target.value == \"\") {\n      this.price = \"0\";\n    }\n\n    // e.target.value = 100;\n  }\n\n  submitForm(e) {\n    e.preventDefault();\n\n    if (this.state.posting) {\n      return;\n    }\n\n    this.setState({\n      posting: true\n    });\n\n    var ajax = new Ajax(\n      {\n        url: '/api/create',\n        method: 'POST',\n        contentType: 'application/json',\n        data: JSON.stringify({\n          title: this.refs.form.inputTitle.value,\n          description: this.refs.form.inputDescription.value,\n          price: this.refs.form.inputPrice.value,\n          image: this.state.image\n        })\n      }\n    );\n\n    ajax.on('success', (e) => {\n      var res = JSON.parse(e.target.response);\n\n      if (res.success) {\n        this.context.router.push('/item/' + res.id);\n      } else {\n        this.setState({\n          posting: false\n        });\n      }\n    });\n\n    ajax.on('error', () => {\n      this.setState({\n        posting: false\n      });\n    });\n\n    ajax.send();\n  }\n\n  render() {\n    return <div>\n      <form className=\"form-horizontal\" ref=\"form\" onSubmit={this.submitForm.bind(this)}>\n\n          <div className=\"form-group\">\n              <label htmlFor=\"inputTitle\" className=\"col-sm-2 control-label\">Title</label>\n              <div className=\"col-sm-10\">\n                  <input type=\"text\" className=\"form-control\" id=\"inputTitle\" placeholder=\"Title\" />\n              </div>\n          </div>\n\n          <div className=\"form-group\">\n              <label htmlFor=\"inputDescription\" className=\"col-sm-2 control-label\">Description</label>\n              <div className=\"col-sm-10\">\n                  <textarea className=\"form-control\" id=\"inputDescription\" placeholder=\"Description\" />\n              </div>\n          </div>\n\n          <div className=\"form-group\">\n              <label htmlFor=\"inputPrice\" className=\"col-sm-2 control-label\">Price $</label>\n              <div className=\"col-sm-10\">\n                  <input type=\"text\" className=\"form-control\" id=\"inputPrice\" placeholder=\"Price\" onChange={this.checkPrice.bind(this)}/>\n              </div>\n          </div>\n\n          <div className=\"form-group\">\n              <label htmlFor=\"inputFile\" className=\"col-sm-2 control-label\">Image</label>\n              <div className=\"col-sm-10\">\n                  <input type=\"file\" id=\"inputFile\" ref=\"fileUpload\" accept=\"image/*\" onChange={this.onFileUpload.bind(this)} />\n                  <br />\n                  {\n                    this.state.image ? <SmartImage src={this.state.image} /> : null\n                  }\n              </div>\n          </div>\n\n          <div className=\"form-group\">\n              <div className=\"col-sm-offset-2 col-sm-10\">\n                  <button type=\"submit\" className=\"btn btn-default\">{this.state.posting ? \"Posting...\" : \"Post\"}</button>\n              </div>\n          </div>\n\n      </form>\n    </div>\n  }\n}"]}