{"version":3,"sources":["../../client/User.js"],"names":["listeners","reload","fn","indexOf","push","remove","arg","listener","ajax","url","method","contentType","on","e","console","log","target","response","res","JSON","parse","success","state","loggedIn","dispatch","setState","error","loading","send"],"mappings":";;;;;;;;AACA;;;;;;;;kBAEe;AAIb,kBAAc;AAAA;;AAAA,SAFdA,SAEc,GAFF,EAEE;;AACZ,SAAKC,MAAL;AACD;;AANY;AAAA;AAAA,gCAQDC,EARC,EAQG;AACd,UAAI,KAAKF,SAAL,CAAeG,OAAf,CAAuBD,EAAvB,KAA8B,CAAC,CAAnC,EAAsC;AACpC,aAAKF,SAAL,CAAeI,IAAf,CAAoBF,EAApB;AACD;AACF;AAZY;AAAA;AAAA,mCAcEA,EAdF,EAcM;AACjB,UAAI,KAAKF,SAAL,CAAeG,OAAf,CAAuBD,EAAvB,KAA8B,CAAC,CAAnC,EAAsC;AACpC,aAAKF,SAAL,CAAeK,MAAf,CAAsB,KAAKL,SAAL,CAAeG,OAAf,CAAuBD,EAAvB,CAAtB,EAAkD,CAAlD;AACD;AACF;AAlBY;AAAA;AAAA,6BAoBJI,GApBI,EAoBC;AACZ,WAAK,IAAIC,QAAT,IAAqB,KAAKP,SAA1B,EAAqC;AACnCO,iBAASD,GAAT;AACD;AACF;AAxBY;AAAA;AAAA,6BA0BJ;AAAA;;AAEP,UAAIE,OAAO,yBACT;AACEC,aAAK,mBADP;AAEEC,gBAAQ,KAFV;AAGEC,qBAAa;AAHf,OADS,CAAX;;AAQAH,WAAKI,EAAL,CAAQ,SAAR,EAAmB,UAACC,CAAD,EAAO;AACxBC,gBAAQC,GAAR,CAAYF,EAAEG,MAAF,CAASC,QAArB;;AAEA,YAAIC,MAAMC,KAAKC,KAAL,CAAWP,EAAEG,MAAF,CAASC,QAApB,CAAV;;AAEA,YAAIC,IAAIG,OAAR,EAAiB;AACf,gBAAKC,KAAL,GAAaJ,GAAb;AACA,gBAAKI,KAAL,CAAWC,QAAX,GAAsB,IAAtB;AACD,SAHD,MAGO;AACL,gBAAKD,KAAL,GAAa,EAAb;AACA,gBAAKA,KAAL,CAAWC,QAAX,GAAsB,KAAtB;AACD;;AAED,cAAKC,QAAL,CAAc,MAAKF,KAAnB;AACD,OAdD;;AAgBAd,WAAKI,EAAL,CAAQ,OAAR,EAAiB,YAAM;AACrB,cAAKa,QAAL,CAAc;AACZC,iBAAO,YADK;AAEZC,mBAAS;AAFG,SAAd;AAID,OALD;;AAOAnB,WAAKoB,IAAL;AAED;AA7DY;;AAAA;AAAA,M","file":"User.js","sourcesContent":["\nimport Ajax from 'simple-ajax';\n\nexport default new class User {\n\n  listeners = []\n\n  constructor() {\n    this.reload();\n  }\n\n  addListener(fn) {\n    if (this.listeners.indexOf(fn) == -1) {\n      this.listeners.push(fn);\n    }\n  }\n\n  removeListener(fn) {\n    if (this.listeners.indexOf(fn) != -1) {\n      this.listeners.remove(this.listeners.indexOf(fn), 1);\n    }\n  }\n\n  dispatch(arg) {\n    for (var listener of this.listeners) {\n      listener(arg);\n    }\n  }\n\n  reload() {\n\n    var ajax = new Ajax(\n      {\n        url: '/api/current_user',\n        method: 'GET',\n        contentType: 'application/json'\n      }\n    );\n\n    ajax.on('success', (e) => {\n      console.log(e.target.response);\n\n      var res = JSON.parse(e.target.response);\n\n      if (res.success) {\n        this.state = res;\n        this.state.loggedIn = true;\n      } else {\n        this.state = {};\n        this.state.loggedIn = false;\n      }\n\n      this.dispatch(this.state);\n    });\n\n    ajax.on('error', () => {\n      this.setState({\n        error: \"Ajax Error\",\n        loading: false\n      });\n    });\n\n    ajax.send();\n    \n  }\n}\n"]}