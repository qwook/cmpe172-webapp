{"version":3,"sources":["../../client/ItemScreen.js"],"names":["ItemScreen","state","commentHidden","reloadThis","ajax","url","props","params","itemId","method","contentType","on","e","console","log","target","response","res","JSON","parse","success","setState","title","description","user","price","comments","error","err","loading","send","refs","commentInput","focus","$","hideCommentButton","tooltip","selector","username","setTimeout","preventDefault","disabled","submitButton","data","stringify","content","value","hidden","fontWeight","color","fontSize","makeComment","bind","toggleCommentHide","Component","contextTypes","router","PropTypes","object"],"mappings":"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","file":"ItemScreen.js","sourcesContent":["\nimport React from 'react';\nimport Ajax from 'simple-ajax';\n\nimport SmartImage from './SmartImage';\nimport Comments from './Comments';\n\nexport default class ItemScreen extends React.Component {\n\n  static contextTypes = {\n      router: React.PropTypes.object\n  };\n\n  state = {\n    commentHidden: false\n  };\n\n  componentWillMount() {\n    this.reloadThis();\n  }\n\n  reloadThis() {\n    var ajax = new Ajax(\n      {\n        url: '/api/item/' + this.props.params.itemId,\n        method: 'GET',\n        contentType: 'application/json'\n      }\n    );\n\n    ajax.on('success', (e) => {\n      console.log(e.target.response);\n\n      var res = JSON.parse(e.target.response);\n\n      if (res.success) {\n        this.setState({\n          title: res.title,\n          description: res.description,\n          user: res.user,\n          price: res.price,\n          comments: res.comments\n        });\n      } else {\n        this.setState({\n          error: res.err\n        });\n      }\n    });\n\n    ajax.on('error', () => {\n      this.setState({\n        error: \"Ajax Error\",\n        loading: false\n      });\n    });\n\n    ajax.send();\n  }\n\n  componentDidMount() {\n    this.refs.commentInput.focus();\n    $(this.refs.hideCommentButton).tooltip({selector: true, title: () => this.state.commentHidden ? \"Only \" + (this.state.user ? this.state.user.username : \"ERR\") + \" can see this comment.\" : \"Everyone can see this comment.\"});\n  }\n\n  toggleCommentHide() {\n    this.setState({\n      commentHidden: !this.state.commentHidden\n    });\n    // $(this.refs.hideCommentButton).tooltip('hide');\n    setTimeout(() => $(this.refs.hideCommentButton).tooltip('show'), 0);\n  }\n\n  makeComment(e) {\n    e.preventDefault();\n    this.refs.commentInput.disabled = true;\n    this.refs.submitButton.disabled = true;\n    this.refs.hideCommentButton.disabled = true;\n\n\n    var ajax = new Ajax(\n      {\n        url: '/api/comment',\n        method: 'POST',\n        contentType: 'application/json',\n        data: JSON.stringify({\n          itemId: this.props.params.itemId,\n          content: this.refs.commentInput.value,\n          hidden: this.state.commentHidden\n        })\n      }\n    );\n\n    ajax.on('success', (e) => {\n      var res = JSON.parse(e.target.response);\n\n      if (res.success) {\n        //\n        console.log(\"succeeded_in_commenting\");\n        this.reloadThis();\n        this.refs.commentInput.value = \"\";\n      } else {\n        console.log(res.err);\n      }\n    });\n\n    ajax.on('error', () => {\n      //\n    });\n\n    ajax.on('complete', () => {\n      this.refs.commentInput.disabled = false;\n      this.refs.submitButton.disabled = false;\n      this.refs.hideCommentButton.disabled = false;\n    })\n\n    ajax.send();\n\n  }\n\n  render() {\n    console.log(this.state.comments);\n    return <div>\n      <div className=\"row\">\n        <div className=\"col-xs-12\">\n          <p style={{fontWeight: \"bold\"}}>{this.state.user ? this.state.user.username : null}</p>\n        </div>\n      </div>\n      <SmartImage src={\"/image/\" + this.props.params.itemId} />\n      <br />\n      <div className=\"row\">\n        <div className=\"col-xs-8\">\n          <h4>{this.state.title}</h4>\n          <p>{this.state.description}</p>\n        </div>\n        <div className=\"col-xs-4\">\n          <p style={{fontWeight: \"bold\", color: \"green\", fontSize: \"18pt\"}}>${this.state.price}</p>\n        </div>\n      </div>\n      <hr />\n      <div className=\"row\">\n        <div className=\"col-xs-12\">\n          <Comments comments={this.state.comments} />\n          <form className=\"input-group\" ref=\"commentForm\" onSubmit={this.makeComment.bind(this)}>\n            <input className=\"form-control\" type=\"text\" ref=\"commentInput\" />\n            <span className=\"input-group-btn\" ref=\"hideCommentButton\" data-toggle=\"tooltip\" data-placement=\"left\">\n              <div className=\"btn btn-default\" onClick={this.toggleCommentHide.bind(this)}><span className={\"glyphicon \" + (this.state.commentHidden ? \"glyphicon-eye-close\" : \"glyphicon-eye-open\")} /></div>\n            </span>\n            <span className=\"input-group-btn\">\n              <input type=\"submit\" ref=\"submitButton\" className=\"btn btn-primary\" value=\"Send\"/>\n            </span>\n          </form>\n        </div>\n      </div>\n    </div>\n  }\n}"]}