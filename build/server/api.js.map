{"version":3,"sources":["../../server/api.js"],"names":["app","get","req","res","send","test","post","body","title","length","description","success","Post","models","key","console","log","create","price","image","timestamp","Date","getTime","err","result","id","_id","params","itemId","set","end","Buffer","split","user","username","comments","find","order","posts","map"],"mappings":";;;;;;kBACe,UAASA,GAAT,EAAc;;AAE3BA,MAAIC,GAAJ,CAAQ,MAAR,EAAgB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC5BA,QAAIC,IAAJ,CAAS,EAACC,MAAM,IAAP,EAAT;AACD,GAFD;;AAIAL,MAAIM,IAAJ,CAAS,aAAT,EAAwB,UAACJ,GAAD,EAAMC,GAAN,EAAc;AACpC,QAAI,CAACD,IAAIK,IAAJ,CAASC,KAAV,IAAmBN,IAAIK,IAAJ,CAASC,KAAT,CAAeC,MAAf,IAAyB,CAA5C,IACA,CAACP,IAAIK,IAAJ,CAASG,WADV,IACyBR,IAAIK,IAAJ,CAASG,WAAT,CAAqBD,MAArB,IAA+B,CAD5D,EAC+D;AAC7DN,UAAIC,IAAJ,CAAS,EAACO,SAAS,KAAV,EAAT;AACD,KAHD,MAGO;AACL,UAAIC,OAAOV,IAAIW,MAAJ,CAAWD,IAAtB;;AAEA,WAAK,IAAIE,GAAT,IAAgBZ,IAAIK,IAApB,EAA0B;AACxBQ,gBAAQC,GAAR,CAAYF,GAAZ;AACD;AACD;AACA;;AAEAF,WAAKK,MAAL,CAAY;AACVT,eAAON,IAAIK,IAAJ,CAASC,KADN;AAEVE,qBAAaR,IAAIK,IAAJ,CAASG,WAFZ;AAGVQ,eAAOhB,IAAIK,IAAJ,CAASW,KAHN;AAIVC,eAAOjB,IAAIK,IAAJ,CAASY,KAJN;AAKVC,mBAAY,IAAIC,IAAJ,EAAD,CAAWC,OAAX;AALD,OAAZ,EAMG,UAACC,GAAD,EAAMC,MAAN,EAAiB;AAClB,YAAID,GAAJ,EAAS;AACPR,kBAAQC,GAAR,CAAYO,GAAZ;AACApB,cAAIC,IAAJ,CAAS,EAACO,SAAS,KAAV,EAAT;AACD,SAHD,MAGO;AACLR,cAAIC,IAAJ,CAAS,EAACO,SAAS,IAAV,EAAgBc,IAAID,OAAOE,GAA3B,EAAT;AACD;AACF,OAbD;AAcD;AACF,GA5BD;;AA8BA1B,MAAIC,GAAJ,CAAQ,gBAAR,EAA0B,UAACC,GAAD,EAAMC,GAAN,EAAc;AACtC,QAAIS,OAAOV,IAAIW,MAAJ,CAAWD,IAAtB;AACAA,SAAKX,GAAL,CAASC,IAAIyB,MAAJ,CAAWC,MAApB,EAA4B,UAACL,GAAD,EAAMjB,IAAN,EAAe;AACzC,UAAIiB,OAAO,CAACjB,KAAKa,KAAjB,EAAwB;AACtBhB,YAAIC,IAAJ,CAAS,YAAYmB,GAArB;AACD,OAFD,MAEO;AACLpB,YAAI0B,GAAJ,CAAQ,cAAR,EAAwB,WAAxB;AACA1B,YAAI2B,GAAJ,CAAQ,IAAIC,MAAJ,CAAWzB,KAAKa,KAAL,CAAWa,KAAX,CAAiB,GAAjB,EAAsB,CAAtB,CAAX,EAAqC,QAArC,CAAR,EAAwD,QAAxD;AACD;AACF,KAPD;AAQD,GAVD;;AAYAhC,MAAIC,GAAJ,CAAQ,mBAAR,EAA6B,UAACC,GAAD,EAAMC,GAAN,EAAc;AACzC,QAAIS,OAAOV,IAAIW,MAAJ,CAAWD,IAAtB;AACAA,SAAKX,GAAL,CAASC,IAAIyB,MAAJ,CAAWC,MAApB,EAA4B,UAACL,GAAD,EAAMjB,IAAN,EAAe;AACzC,UAAIiB,OAAO,CAACjB,KAAKE,KAAb,IAAsB,CAACF,KAAKa,KAAhC,EAAuC;AACrChB,YAAIC,IAAJ,CAAS,EAACO,SAAS,KAAV,EAAiBY,KAAKA,GAAtB,EAAT;AACD,OAFD,MAEO;AACLR,gBAAQC,GAAR,CAAYV,KAAKY,KAAjB;AACAf,YAAIC,IAAJ,CAAS;AACPO,mBAAS,IADF;AAEPH,iBAAOF,KAAKE,KAFL;AAGPE,uBAAaJ,KAAKI,WAHX;AAIPQ,iBAAOZ,KAAKY,KAJL;AAKPe,gBAAM;AACJP,iBAAK,OADD;AAEJQ,sBAAU;AAFN,WALC;AASPR,eAAKpB,KAAKoB,GATH;AAUPS,oBAAU;AAVH,SAAT;AAYD;AACF,KAlBD;AAmBD,GArBD;;AAuBAnC,MAAIC,GAAJ,CAAQ,WAAR,EAAqB,UAACC,GAAD,EAAMC,GAAN,EAAc;AACjC,QAAIS,OAAOV,IAAIW,MAAJ,CAAWD,IAAtB;AACAA,SAAKwB,IAAL,CAAU,EAAV,EAAc,EAACC,OAAO,CAAC,YAAD,CAAR,EAAd,EAAuC,UAACd,GAAD,EAAMe,KAAN,EAAgB;AACrDnC,UAAIC,IAAJ,CAAS;AACPO,iBAAS,IADF;AAEP2B,eAAOA,MAAMC,GAAN,CAAU,UAACjC,IAAD,EAAU;AACzB,iBAAO;AACLE,mBAAOF,KAAKE,KADP;AAELE,yBAAaJ,KAAKI,WAFb;AAGLQ,mBAAOZ,KAAKY,KAHP;AAILe,kBAAM;AACJP,mBAAK,OADD;AAEJQ,wBAAU;AAFN,aAJD;AAQLR,iBAAKpB,KAAKoB;AARL,WAAP;AAUD,SAXM;AAFA,OAAT;AAeD,KAhBD;AAiBD,GAnBD;AAqBD,C","file":"api.js","sourcesContent":["\nexport default function(app) {\n\n  app.get('/api', (req, res) => {\n    res.send({test: 'hi'});\n  })\n\n  app.post('/api/create', (req, res) => {\n    if (!req.body.title || req.body.title.length == 0 ||\n        !req.body.description || req.body.description.length == 0) {\n      res.send({success: false});\n    } else {\n      let Post = req.models.Post\n\n      for (let key in req.body) {\n        console.log(key);\n      }\n      // console.log(req.body);\n      // console.log(req.body.image);\n\n      Post.create({\n        title: req.body.title,\n        description: req.body.description,\n        price: req.body.price,\n        image: req.body.image,\n        timestamp: (new Date).getTime()\n      }, (err, result) => {\n        if (err) {\n          console.log(err);\n          res.send({success: false});\n        } else {\n          res.send({success: true, id: result._id});\n        }\n      })\n    }\n  });\n\n  app.get('/image/:itemId', (req, res) => {\n    let Post = req.models.Post;\n    Post.get(req.params.itemId, (err, post) => {\n      if (err || !post.image) {\n        res.send(\"Error! \" + err);\n      } else {\n        res.set('Content-Type', 'image/png');\n        res.end(new Buffer(post.image.split(\",\")[1], 'base64'), 'binary');\n      }\n    })\n  })\n\n  app.get('/api/item/:itemId', (req, res) => {\n    let Post = req.models.Post;\n    Post.get(req.params.itemId, (err, post) => {\n      if (err || !post.title || !post.image) {\n        res.send({success: false, err: err});\n      } else {\n        console.log(post.price);\n        res.send({\n          success: true,\n          title: post.title,\n          description: post.description,\n          price: post.price,\n          user: {\n            _id: \"BLANK\",\n            username: \"BLANK\"\n          },\n          _id: post._id,\n          comments: []\n        })\n      }\n    })\n  })\n\n  app.get('/api/feed', (req, res) => {\n    let Post = req.models.Post;\n    Post.find({}, {order: [\"-timestamp\"]}, (err, posts) => {\n      res.send({\n        success: true,\n        posts: posts.map((post) => {\n          return {\n            title: post.title,\n            description: post.description,\n            price: post.price,\n            user: {\n              _id: \"BLANK\",\n              username: \"BLANK\"\n            },\n            _id: post._id,\n          }\n        })\n      })\n    })\n  });\n\n}\n"]}