{"version":3,"sources":["../../server/api.js"],"names":["app","get","req","res","send","test","post","body","title","length","description","success","Post","models","create","price","image","timestamp","Date","getTime","err","result","console","log","id","_id","params","itemId","set","end","Buffer","split","user","username","comments","find","order","posts","map"],"mappings":"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","file":"api.js","sourcesContent":["\nexport default function(app) {\n\n  app.get('/api', (req, res) => {\n    res.send({test: 'hi'});\n  })\n\n  app.post('/api/create', (req, res) => {\n    if (!req.body.title || req.body.title.length == 0 ||\n        !req.body.description || req.body.description.length == 0) {\n      res.send({success: false});\n    } else {\n      let Post = req.models.Post\n\n      Post.create({\n        title: req.body.title,\n        description: req.body.description,\n        price: req.body.price,\n        image: req.body.image,\n        timestamp: (new Date).getTime()\n      }, (err, result) => {\n        if (err) {\n          console.log(err);\n          res.send({success: false});\n        } else {\n          res.send({success: true, id: result._id});\n        }\n      })\n    }\n  });\n\n  app.get('/image/:itemId', (req, res) => {\n    let Post = req.models.Post;\n    Post.get(req.params.itemId, (err, post) => {\n      if (err || !post.image) {\n        res.send(\"Error! \" + err);\n      } else {\n        res.set('Content-Type', 'image/png');\n        res.end(new Buffer(post.image.split(\",\")[1], 'base64'), 'binary');\n      }\n    })\n  })\n\n  app.get('/api/item/:itemId', (req, res) => {\n    let Post = req.models.Post;\n    Post.get(req.params.itemId, (err, post) => {\n      if (err || !post.title || !post.image) {\n        res.send({success: false, err: err});\n      } else {\n        console.log(post.price);\n        res.send({\n          success: true,\n          title: post.title,\n          description: post.description,\n          price: post.price,\n          user: {\n            _id: \"BLANK\",\n            username: \"BLANK\"\n          },\n          _id: post._id,\n          comments: []\n        })\n      }\n    })\n  })\n\n  app.get('/api/feed', (req, res) => {\n    let Post = req.models.Post;\n    Post.find({}, {order: [\"-timestamp\"]}, (err, posts) => {\n      res.send({\n        success: true,\n        posts: posts.map((post) => {\n          return {\n            title: post.title,\n            description: post.description,\n            price: post.price,\n            user: {\n              _id: \"BLANK\",\n              username: \"BLANK\"\n            },\n            _id: post._id,\n          }\n        })\n      })\n    })\n  });\n\n  app.get('/api/comments', (req, res) => {\n    \n  })\n\n}\n"]}